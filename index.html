import React, { useState, useEffect } from 'react';
import { Play, Plus, Clock, Menu, X, Trash2, ExternalLink, Lock, User, Activity, Globe, Image as ImageIcon, Settings, Upload, ArrowLeft, RefreshCw, AlertCircle, Monitor, Globe as GlobeIcon, WifiOff, HardDrive, Youtube, Facebook } from 'lucide-react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from 'firebase/auth';
import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, query, setDoc } from 'firebase/firestore';

// --- KONFIGURASI FIREBASE ---
// PENTING: Saat deploy ke Firebase Hosting, ganti isi variable ini dengan config asli dari Firebase Console.
const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
  apiKey: "GANTI_DENGAN_API_KEY_ANDA",
  authDomain: "PROJECT_ID_ANDA.firebaseapp.com",
  projectId: "PROJECT_ID_ANDA",
  storageBucket: "PROJECT_ID_ANDA.appspot.com",
  messagingSenderId: "SENDER_ID_ANDA",
  appId: "APP_ID_ANDA"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
// Gunakan ID unik manual jika di luar environment ini
const appId = typeof __app_id !== 'undefined' ? __app_id : 'ai-mbelgedez-community';

export default function App() {
  const [videos, setVideos] = useState([]);
  const [currentVideo, setCurrentVideo] = useState(null);
  
  // State Logo
  const defaultLogo = "https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Smilies/Robot.png";
  const [logoUrl, setLogoUrl] = useState(defaultLogo);
  
  // UI State
  const [isSidebarOpen, setIsSidebarOpen] = useState(true);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [isLoginModalOpen, setIsLoginModalOpen] = useState(false);
  const [isLogoModalOpen, setIsLogoModalOpen] = useState(false); 
  const [isOffline, setIsOffline] = useState(false);
  
  // Admin State
  const [isAdmin, setIsAdmin] = useState(false);
  const [passwordInput, setPasswordInput] = useState('');
  const [loginError, setLoginError] = useState('');
  const [user, setUser] = useState(null);

  // Upload Form
  const [newVideoTitle, setNewVideoTitle] = useState('');
  const [newVideoDesc, setNewVideoDesc] = useState('');
  const [newVideoUrl, setNewVideoUrl] = useState('');
  const [newVideoThumbnail, setNewVideoThumbnail] = useState(''); 
  const [newVideoDuration, setNewVideoDuration] = useState('');
  const [linkWarning, setLinkWarning] = useState('');
  
  // Logo Form
  const [newLogoInput, setNewLogoInput] = useState('');
  const [logoUploadError, setLogoUploadError] = useState('');
  const [isCompressing, setIsCompressing] = useState(false);

  // Auth Init
  useEffect(() => {
    const initAuth = async () => {
      try {
        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
          await signInWithCustomToken(auth, __initial_auth_token);
        } else {
          await signInAnonymously(auth);
        }
      } catch (err) { console.error("Auth Error:", err); setIsOffline(true); }
    };
    initAuth();
    const unsubscribe = onAuthStateChanged(auth, (u) => setUser(u));
    return () => unsubscribe();
  }, []);

  // Data Fetching
  useEffect(() => {
    if (!user) return;
    
    // Fetch Videos
    const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'tutorial-videos'));
    const unsubscribeVideos = onSnapshot(q, (snapshot) => {
      setIsOffline(false);
      const videoList = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      videoList.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
      setVideos(videoList);
      if (!currentVideo && videoList.length > 0) setCurrentVideo(videoList[0]);
    }, (error) => {
      console.error("Error fetching videos:", error);
      setIsOffline(true);
    });

    // Fetch Config Logo
    const configRef = doc(db, 'artifacts', appId, 'public', 'data', 'app-config', 'general');
    const unsubscribeConfig = onSnapshot(configRef, (docSnap) => {
      if (docSnap.exists()) {
        const data = docSnap.data();
        if (data?.logoUrl) setLogoUrl(data.logoUrl);
      }
    });

    return () => { unsubscribeVideos(); unsubscribeConfig(); };
  }, [user, currentVideo]);

  // Helper: Get YouTube Thumbnail Auto
  const getYouTubeThumb = (url) => {
    try {
      let vId = "";
      if (url.includes("shorts")) vId = url.split("shorts/")[1].split("?")[0];
      else if (url.includes("v=")) vId = url.split("v=")[1].split("&")[0];
      else if (url.includes("youtu.be")) vId = url.split("youtu.be/")[1].split("?")[0];
      
      if (vId) return `https://img.youtube.com/vi/${vId}/hqdefault.jpg`;
    } catch (e) { return null; }
    return null;
  };

  // Handlers
  const handleLogin = (e) => {
    e.preventDefault();
    if (passwordInput === 'admin123') { setIsAdmin(true); setIsLoginModalOpen(false); setPasswordInput(''); setLoginError(''); }
    else { setLoginError('Password salah brow!'); }
  };

  const handleAddVideo = async (e) => {
    e.preventDefault();
    if (!user) return;

    let finalThumbnail = newVideoThumbnail;
    // Auto thumbnail logic jika kosong
    if (!finalThumbnail) {
        const ytThumb = getYouTubeThumb(newVideoUrl);
        if (ytThumb) {
            finalThumbnail = ytThumb;
        } else if (newVideoUrl.includes("drive")) {
            finalThumbnail = "https://images.unsplash.com/photo-1620712943543-bcc4688e7485?w=800&q=80"; // Cloud Image Placeholder
        } else if (newVideoUrl.includes("facebook") || newVideoUrl.includes("fb.")) {
            finalThumbnail = "https://images.unsplash.com/photo-1611162617213-7d7a39e9b1d7?w=800&q=80"; // Facebook Placeholder
        } else {
            finalThumbnail = "https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?w=800&q=80"; // Default Abstract
        }
    }

    try {
      await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'tutorial-videos'), {
        title: newVideoTitle,
        description: newVideoDesc || "Tidak ada deskripsi",
        url: newVideoUrl,
        thumbnail: finalThumbnail,
        duration: newVideoDuration || "??:??",
        type: "mp4", // Default type
        createdAt: Date.now()
      });
      setNewVideoTitle(''); setNewVideoDesc(''); setNewVideoUrl(''); setNewVideoThumbnail(''); setNewVideoDuration(''); setLinkWarning(''); setIsModalOpen(false);
    } catch (error) { 
      alert("Gagal upload video. Pastikan koneksi aman brow."); 
    }
  };

  const handleDeleteVideo = async (e, id) => {
    e.stopPropagation();
    if (!isAdmin) return;
    if (window.confirm("Hapus video ini?")) {
      try {
        await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'tutorial-videos', id));
        if (currentVideo?.id === id) setCurrentVideo(videos.find(v => v.id !== id) || null);
      } catch (err) {
        alert("Gagal hapus data. Cek koneksi.");
      }
    }
  };

  const handleUpdateLogo = async (e) => {
    e.preventDefault();
    if (!user || !newLogoInput) return;
    try {
      await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'app-config', 'general'), { logoUrl: newLogoInput, updatedAt: Date.now() }, { merge: true });
      setIsLogoModalOpen(false); setNewLogoInput('');
    } catch (err) {
      alert("Gagal update logo. Cek koneksi.");
    }
  };

  const handleLogoFileChange = (e) => {
    const file = e.target.files[0];
    if (file) {
      setIsCompressing(true);
      const reader = new FileReader();
      reader.onload = (ev) => {
        const img = new Image();
        img.onload = () => {
          const canvas = document.createElement('canvas');
          let w = img.width, h = img.height;
          const MAX = 200;
          if (w > h) { if (w > MAX) { h *= MAX/w; w = MAX; } } else { if (h > MAX) { w *= MAX/h; h = MAX; } }
          canvas.width = w; canvas.height = h;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0, w, h);
          setNewLogoInput(canvas.toDataURL('image/webp', 0.85));
          setIsCompressing(false);
        };
        img.src = ev.target.result;
      };
      reader.readAsDataURL(file);
    }
  };

  // --- LOGIC PLAYER ---
  
  // Cek apakah link bisa di-embed langsung (Iframe)
  // KITA EXCLUDE FACEBOOK DARI SINI AGAR MUNCUL SEBAGAI KARTU PLAYER YANG AMAN
  const isEmbeddable = (url) => {
    if (!url) return false;
    const lower = url.toLowerCase();
    // Hanya YouTube dan Drive yang kita izinkan iframe, sisanya pakai External UI (Biar gak error)
    return lower.includes("youtube") || 
           lower.includes("youtu.be") || 
           lower.includes("drive.google.com");
  };

  const getEmbedUrl = (url) => {
    if (!url) return "";
    const lower = url.toLowerCase();
    try {
      // Google Drive Handler
      if (lower.includes("drive.google.com")) {
        let id = "";
        if (url.includes("/d/")) id = url.split("/d/")[1].split("/")[0];
        else if (url.includes("id=")) id = url.split("id=")[1].split("&")[0];
        if (id) return `https://drive.google.com/file/d/${id}/preview`;
      }
      // YouTube Handler
      if (lower.includes("youtube.com") || lower.includes("youtu.be")) {
        let vId = "";
        if (lower.includes("shorts")) vId = url.split("shorts/")[1].split("?")[0];
        else if (lower.includes("v=")) vId = url.split("v=")[1].split("&")[0];
        else if (lower.includes("youtu.be")) vId = url.split("youtu.be/")[1].split("?")[0];
        return `https://www.youtube.com/embed/${vId}?rel=0&modestbranding=1&playsinline=1`;
      }
    } catch(e) { return url; }
    return url;
  };

  const isVideoFile = (url) => {
    if(!url) return false;
    const lower = url.toLowerCase();
    return lower.endsWith('.mp4') || lower.endsWith('.webm') || lower.endsWith('.ogg');
  };

  const getSourceIcon = (url) => {
    if (!url) return <Globe size={12} className="text-slate-400"/>;
    const lower = url.toLowerCase();
    if(lower.includes('drive.google')) return <HardDrive size={12} className="text-green-500"/>;
    if(lower.includes('youtube') || lower.includes('youtu.be')) return <Youtube size={12} className="text-red-500"/>;
    if(lower.includes('facebook') || lower.includes('fb.')) return <Facebook size={12} className="text-blue-500"/>;
    return <Globe size={12} className="text-slate-400"/>;
  };

  const getSourceName = (url) => {
    if (!url) return 'Web Browser';
    const lower = url.toLowerCase();
    if(lower.includes('drive.google')) return 'Google Drive';
    if(lower.includes('youtube') || lower.includes('youtu.be')) return 'YouTube';
    if(lower.includes('facebook') || lower.includes('fb.')) return 'Facebook';
    return 'Web Browser';
  };

  return (
    <div className="flex h-screen bg-[#09090b] text-slate-200 font-sans overflow-hidden selection:bg-purple-500/30 relative">
      <div className="absolute inset-0 z-0 opacity-40 pointer-events-none" style={{ backgroundImage: `url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=2564&auto=format&fit=crop')`, backgroundSize: 'cover', backgroundPosition: 'center', filter: 'blur(40px) saturate(150%)' }}></div>

      {/* SIDEBAR */}
      <div className={`${isSidebarOpen ? 'w-full md:w-80' : 'w-0'} transition-all duration-300 bg-black/40 backdrop-blur-md border-r border-white/10 flex flex-col absolute md:relative z-20 h-full shadow-2xl`}>
        <div className="p-6 border-b border-white/10 flex justify-between items-start bg-gradient-to-b from-white/5 to-transparent shrink-0">
          <div className="flex flex-col gap-2">
            <div className="flex items-center gap-3 cursor-pointer group" onClick={() => !isAdmin && setIsLoginModalOpen(true)}>
               <img src={logoUrl} alt="Logo" className="h-10 w-auto max-w-[120px] object-contain drop-shadow-[0_0_10px_rgba(168,85,247,0.5)] group-hover:scale-105 transition-transform" onError={(e) => { if(e.target.src !== defaultLogo) e.target.src = defaultLogo; }} />
               <h2 className="text-lg font-black tracking-tight text-white bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400">Ai Mbelgedez</h2>
            </div>
            <span className="text-[10px] font-bold tracking-widest text-slate-400 uppercase ml-1">Community Indonesia</span>
          </div>
          <button onClick={() => setIsSidebarOpen(false)} className="md:hidden text-slate-500"><X size={24} /></button>
        </div>

        <div className="p-4 space-y-3 shrink-0">
          {isOffline && (
            <div className="bg-red-500/10 border border-red-500/20 p-2 rounded-xl flex items-center gap-2 px-3 text-red-400 text-xs mb-2">
              <WifiOff size={14} />
              <span>Koneksi terputus. Mode Offline.</span>
            </div>
          )}
          
          {isAdmin ? (
            <div className="space-y-3 animate-fadeIn">
              <div className="bg-emerald-500/10 border border-emerald-500/20 p-3 rounded-xl flex justify-between items-center px-4">
                <span className="text-xs text-emerald-300 font-bold flex gap-2 items-center"><div className="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"></div>Admin Mode</span>
                <button onClick={() => setIsAdmin(false)} className="text-xs text-slate-400 hover:text-white underline">Logout</button>
              </div>
              <div className="grid grid-cols-2 gap-2">
                <button onClick={() => setIsModalOpen(true)} className="col-span-2 bg-indigo-600/80 hover:bg-indigo-500 text-white py-3 rounded-xl flex justify-center items-center gap-2 text-xs font-bold border border-white/10 transition-all"><Plus size={16}/> Upload Video</button>
                <button onClick={() => { setNewLogoInput(logoUrl); setIsLogoModalOpen(true); }} className="col-span-2 bg-white/5 hover:bg-white/10 text-slate-300 py-2.5 rounded-xl flex justify-center items-center gap-2 text-xs font-medium border border-white/5 transition-all"><Settings size={14}/> Ganti Logo</button>
              </div>
            </div>
          ) : (
             <div className="p-4 bg-white/5 rounded-xl border border-white/5 text-[11px] text-slate-400 text-center">Nikmati tutorial eksklusif seputar AI & Teknologi.</div>
          )}
        </div>

        <div className="flex-1 overflow-y-auto px-3 pb-20 custom-scrollbar">
          <div className="flex justify-between items-center px-2 mb-4 mt-2">
            <h3 className="text-slate-400 text-[10px] font-bold uppercase tracking-wider">Library</h3>
            <span className="bg-black/30 border border-white/5 text-slate-300 px-2 py-0.5 rounded-full text-[10px]">{videos.length} Video</span>
          </div>
          {videos.length === 0 ? (
            <div className="text-center text-slate-500 mt-10 text-xs flex flex-col items-center gap-2">
              {isOffline ? <WifiOff size={24} className="opacity-50"/> : <div className="text-2xl">ðŸ“‚</div>}
              {isOffline ? "Gagal memuat data. Cek internet." : "Belum ada konten brow."}
            </div>
          ) : videos.map(video => (
            <div key={video.id} onClick={() => { setCurrentVideo(video); if(window.innerWidth < 768) setIsSidebarOpen(false); }} className={`group relative flex gap-3 p-3 rounded-xl cursor-pointer mb-2 border transition-all ${currentVideo?.id === video.id ? 'bg-white/10 border-indigo-500/30' : 'bg-black/20 border-transparent hover:bg-white/10'}`}>
              {currentVideo?.id === video.id && <div className="absolute left-0 top-3 bottom-3 w-1 bg-indigo-500 rounded-r-full shadow-[0_0_10px_#6366f1]"></div>}
              <div className="relative w-24 h-16 flex-shrink-0 bg-black/50 rounded-lg overflow-hidden border border-white/10">
                <img src={video.thumbnail} className="w-full h-full object-cover opacity-70" alt={video.title} />
                <div className="absolute bottom-1 right-1 bg-black/60 text-[9px] px-1.5 rounded text-white border border-white/10">{video.duration}</div>
                {/* Indikator Source di Sidebar */}
                <div className="absolute top-1 right-1 bg-black/80 rounded p-0.5 shadow-sm border border-white/10">
                   {getSourceIcon(video.url)}
                </div>
              </div>
              <div className="flex-1 min-w-0 flex flex-col justify-center">
                <h4 className={`text-sm font-medium line-clamp-2 ${currentVideo?.id === video.id ? 'text-indigo-200' : 'text-slate-300'}`}>{video.title}</h4>
                <p className="text-[10px] text-slate-500 mt-1 line-clamp-1">{video.description}</p>
              </div>
              {isAdmin && <button onClick={(e) => handleDeleteVideo(e, video.id)} className="absolute -right-2 -top-2 bg-red-500/20 hover:bg-red-500 text-red-400 hover:text-white p-1.5 rounded-full border border-red-500/20 backdrop-blur-sm opacity-0 group-hover:opacity-100 transition-opacity"><Trash2 size={12}/></button>}
            </div>
          ))}
        </div>
      </div>

      {/* MAIN CONTENT (CINEMATIC PLAYER) */}
      <div className="flex-1 flex flex-col h-full relative z-10 bg-black/30 backdrop-blur-sm">
        {/* Mobile Navbar */}
        <div className="md:hidden p-4 flex justify-between items-center bg-black/60 backdrop-blur-xl border-b border-white/10 sticky top-0 z-50">
          <button onClick={() => setIsSidebarOpen(true)} className="text-slate-300"><Menu size={24}/></button>
          <span className="font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400">Ai Mbelgedez</span>
          <div className="w-6"></div>
        </div>

        {/* PLAYER FRAME */}
        <div className="flex-1 bg-black relative flex items-center justify-center overflow-hidden shadow-inner group">
          {videos.length > 0 && currentVideo ? (
            <div className="w-full h-full relative bg-[#0f0f11] flex flex-col">
              
              {isVideoFile(currentVideo.url) ? (
                // 1. MP4 Direct
                <video key={currentVideo.url} controls className="w-full h-full absolute inset-0 max-h-screen" poster={currentVideo.thumbnail}>
                  <source src={currentVideo.url} type="video/mp4" />
                </video>
              ) : isEmbeddable(currentVideo.url) ? (
                // 2. YouTube & Google Drive (Embed)
                <iframe 
                  key={currentVideo.url}
                  src={getEmbedUrl(currentVideo.url)}
                  title="Video Player"
                  className="w-full h-full absolute inset-0 bg-black"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                  allowFullScreen
                ></iframe>
              ) : (
                // 3. EXTERNAL UI (Facebook dll - Solusi Akhir)
                <div 
                  className="absolute inset-0 w-full h-full flex items-center justify-center bg-black group cursor-pointer overflow-hidden" 
                  onClick={() => window.open(currentVideo.url, '_blank')}
                >
                   {/* Background Image (Blurred & Darkened) */}
                   <div 
                     className="absolute inset-0 bg-cover bg-center opacity-40 blur-md transition-all duration-700 group-hover:opacity-30 group-hover:scale-105"
                     style={{ backgroundImage: `url(${currentVideo.thumbnail})` }}
                   ></div>
                   
                   {/* Tombol Play Raksasa di Tengah */}
                   <div className="relative z-10 flex flex-col items-center justify-center animate-fadeIn p-4 text-center">
                      <div className="w-24 h-24 rounded-full bg-white/10 backdrop-blur-md border border-white/20 flex items-center justify-center shadow-[0_0_50px_rgba(79,70,229,0.3)] group-hover:scale-110 group-hover:bg-indigo-600/80 group-hover:border-indigo-500 transition-all duration-300">
                         <Play size={48} className="text-white fill-white ml-2 opacity-90"/>
                      </div>
                      
                      <h3 className="mt-6 text-xl md:text-2xl font-bold text-white tracking-wide drop-shadow-lg max-w-lg">
                        Tonton Video di {getSourceName(currentVideo.url)}
                      </h3>
                      
                      <div className="mt-3 flex gap-2">
                        <span className="text-xs text-slate-300 bg-black/60 px-4 py-2 rounded-full backdrop-blur border border-white/10 flex items-center gap-2 group-hover:bg-white/10 transition-colors">
                          <ExternalLink size={14}/> Klik untuk membuka player eksternal
                        </span>
                      </div>
                   </div>
                </div>
              )}
            </div>
          ) : (
            <div className="text-center text-slate-500">
              <Play size={48} className="mx-auto mb-4 opacity-20"/>
              <p>Pilih video dari sidebar untuk mulai menonton.</p>
            </div>
          )}
        </div>

        {/* INFO PANEL */}
        {currentVideo && (
          <div className="h-48 bg-[#0c0c0e] border-t border-white/10 p-6 overflow-y-auto shrink-0">
            <h1 className="text-xl font-bold text-white mb-2">{currentVideo.title}</h1>
            <div className="flex gap-4 text-xs text-slate-500 mb-3">
              <span className="flex items-center gap-1"><Clock size={12}/> {currentVideo.duration}</span>
              <span className="flex items-center gap-1">
                 {getSourceIcon(currentVideo.url)} {getSourceName(currentVideo.url)} Source
              </span>
            </div>
            <p className="text-sm text-slate-400 leading-relaxed max-w-4xl">{currentVideo.description}</p>
          </div>
        )}
      </div>

      {/* --- MODALS (Login, Upload, Logo) --- */}
      {/* Login Modal */}
      {isLoginModalOpen && (
        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-[#121214] border border-white/10 rounded-2xl w-full max-w-sm p-6 relative shadow-2xl">
            <button onClick={() => setIsLoginModalOpen(false)} className="absolute top-4 right-4 text-slate-500 hover:text-white"><X size={20}/></button>
            <h3 className="text-lg font-bold text-white mb-6 flex items-center gap-2"><Lock size={18}/> Admin Access</h3>
            <form onSubmit={handleLogin} className="space-y-4">
              <input type="password" value={passwordInput} onChange={e => setPasswordInput(e.target.value)} className="w-full bg-black/50 border border-white/10 rounded-xl p-3 text-white focus:border-indigo-500 outline-none" placeholder="Password Key" autoFocus />
              {loginError && <p className="text-red-500 text-xs">{loginError}</p>}
              <button type="submit" className="w-full bg-white text-black font-bold py-3 rounded-xl hover:bg-slate-200 transition-colors">Unlock</button>
            </form>
          </div>
        </div>
      )}

      {/* Upload Modal */}
      {isModalOpen && (
        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-[#121214] border border-white/10 rounded-2xl w-full max-w-lg flex flex-col max-h-[90vh] shadow-2xl">
            <div className="p-5 border-b border-white/10 flex items-center gap-3">
              <button onClick={() => setIsModalOpen(false)} className="text-slate-400 hover:text-white p-1 rounded-full hover:bg-white/10"><ArrowLeft size={20}/></button>
              <h3 className="font-bold text-white">Upload Materi Baru</h3>
            </div>
            <form onSubmit={handleAddVideo} className="p-6 space-y-4 overflow-y-auto">
              <div><label className="text-xs text-slate-400 font-bold block mb-1">Judul</label><input type="text" value={newVideoTitle} onChange={e => setNewVideoTitle(e.target.value)} required className="w-full bg-black/40 border border-white/10 rounded-xl p-3 text-white outline-none focus:border-indigo-500 placeholder:text-slate-600"/></div>
              <div>
                <label className="text-xs text-slate-400 font-bold block mb-1">Link URL Video</label>
                <div className="relative"><input type="url" value={newVideoUrl} onChange={e => {setNewVideoUrl(e.target.value); if(e.target.value.includes('share/v')) setLinkWarning('Link Share terdeteksi. Gunakan tombol Mode Player di layar jika error.'); else setLinkWarning('');}} required className="w-full bg-black/40 border border-white/10 rounded-xl p-3 pl-10 text-white outline-none focus:border-indigo-500 placeholder:text-slate-600" placeholder="Google Drive / YouTube / Facebook" /><ExternalLink size={16} className="absolute left-3 top-3.5 text-slate-500"/></div>
                {linkWarning && <p className="text-yellow-500 text-[10px] mt-1 flex items-center gap-1"><AlertCircle size={10}/> {linkWarning}</p>}
                <p className="text-xs text-slate-500 mt-1">Prioritas: Google Drive & YouTube. Facebook juga didukung (External Player).</p>
              </div>
              <div>
                <label className="text-xs text-slate-400 font-bold block mb-1">Link Gambar Sampul (Opsional)</label>
                <div className="relative"><input type="url" value={newVideoThumbnail} onChange={e => setNewVideoThumbnail(e.target.value)} className="w-full bg-black/40 border border-white/10 rounded-xl p-3 pl-10 text-white outline-none focus:border-indigo-500 placeholder:text-slate-600" placeholder="https://... (Biarkan kosong untuk Auto/Default)" /><ImageIcon size={16} className="absolute left-3 top-3.5 text-slate-500"/></div>
                <p className="text-[10px] text-slate-500 mt-1">Otomatis untuk YouTube. Untuk Drive/FB, paste link gambar di sini jika ingin cover khusus.</p>
              </div>
              <div><label className="text-xs text-slate-400 font-bold block mb-1">Durasi</label><input type="text" value={newVideoDuration} onChange={e => setNewVideoDuration(e.target.value)} className="w-full bg-black/40 border border-white/10 rounded-xl p-3 text-white outline-none focus:border-indigo-500 placeholder:text-slate-600" placeholder="00:00"/></div>
              <div><label className="text-xs text-slate-400 font-bold block mb-1">Deskripsi</label><textarea value={newVideoDesc} onChange={e => setNewVideoDesc(e.target.value)} className="w-full bg-black/40 border border-white/10 rounded-xl p-3 text-white outline-none focus:border-indigo-500 h-24 resize-none placeholder:text-slate-600"></textarea></div>
              <div className="pt-2 flex gap-3">
                <button type="button" onClick={() => setIsModalOpen(false)} className="flex-1 py-3 rounded-xl border border-white/10 text-slate-300 hover:bg-white/5 text-sm font-bold">Kembali</button>
                <button type="submit" className="flex-1 py-3 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-bold shadow-lg shadow-indigo-900/20">Publish</button>
              </div>
            </form>
          </div>
        </div>
      )}

      {/* Logo Modal */}
      {isLogoModalOpen && (
        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div className="bg-[#121214] border border-white/10 rounded-2xl w-full max-w-md shadow-2xl">
            <div className="p-5 border-b border-white/10 flex items-center gap-3">
              <button onClick={() => setIsLogoModalOpen(false)} className="text-slate-400 hover:text-white p-1 rounded-full hover:bg-white/10"><ArrowLeft size={20}/></button>
              <h3 className="font-bold text-white">Ganti Logo</h3>
            </div>
            <form onSubmit={handleUpdateLogo} className="p-6 space-y-5">
              <div>
                <label className="text-xs text-slate-400 font-bold block mb-2">Upload Gambar</label>
                <div className="relative group cursor-pointer">
                  <input type="file" accept="image/*" onChange={handleLogoFileChange} className="absolute inset-0 w-full h-full opacity-0 z-10 cursor-pointer"/>
                  <div className="border border-dashed border-white/20 bg-black/20 rounded-xl p-6 flex flex-col items-center justify-center hover:bg-white/5 transition-colors">
                    <Upload size={24} className="text-indigo-400 mb-2"/>
                    <span className="text-xs text-slate-300 font-medium">{isCompressing ? 'Memproses...' : 'Klik untuk pilih file'}</span>
                  </div>
                </div>
              </div>
              <div className="flex items-center gap-2"><div className="h-px bg-white/10 flex-1"></div><span className="text-[10px] text-slate-500">ATAU</span><div className="h-px bg-white/10 flex-1"></div></div>
              <div>
                <label className="text-xs text-slate-400 font-bold block mb-1">URL Gambar</label>
                <input type="url" value={newLogoInput.startsWith('data:') ? '' : newLogoInput} onChange={e => setNewLogoInput(e.target.value)} className="w-full bg-black/40 border border-white/10 rounded-xl p-3 text-white outline-none focus:border-indigo-500 text-xs" placeholder="https://..." />
              </div>
              {newLogoInput && <div className="flex justify-center p-4 bg-black/40 rounded-xl border border-white/10"><img src={newLogoInput} className="h-12 object-contain" alt="Preview"/></div>}
              <div className="flex gap-3 pt-2">
                <button type="button" onClick={() => setNewLogoInput(defaultLogo)} className="p-3 rounded-xl border border-white/10 text-slate-400 hover:bg-white/5"><RefreshCw size={16}/></button>
                <button type="submit" disabled={isCompressing} className="flex-1 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold text-sm disabled:opacity-50">Simpan</button>
              </div>
            </form>
          </div>
        </div>
      )}
    </div>
  );
}
